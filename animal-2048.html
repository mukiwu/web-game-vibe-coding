<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Animal 2048</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#57B5E7",
            secondary: "#FB8C62",
          },
          borderRadius: {
            none: "0px",
            sm: "4px",
            DEFAULT: "8px",
            md: "12px",
            lg: "16px",
            xl: "20px",
            "2xl": "24px",
            "3xl": "32px",
            full: "9999px",
            button: "8px",
          },
        },
      },
    };
  </script>
  <style>
    :where([class^="ri-"])::before {
      content: "\f3c2";
    }

    body {
      background-color: #FAF8EF;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .game-grid {
      background-color: #CDC1B4;
      border-radius: 12px;
      padding: 12px;
      gap: 12px;
    }

    .grid-cell {
      background-color: rgba(238, 228, 218, 0.35);
      border-radius: 8px;
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      position: relative;
      transition: all 0.15s ease-in-out;
    }

    .fruit-cell {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: bold;
      transition: all 0.15s ease-in-out;
      animation: appear 0.2s ease-in-out;
    }

    @keyframes appear {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes merge {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.2);
      }

      100% {
        transform: scale(1);
      }
    }

    .merge-animation {
      animation: merge 0.3s ease-in-out;
    }

    .fruit-1 {
      background-color: #FFE4E6;
      color: #DC2626;
    }

    .fruit-2 {
      background-color: #FFF1F2;
      color: #EF4444;
    }

    .fruit-3 {
      background-color: #FFF7ED;
      color: #EA580C;
    }

    .fruit-4 {
      background-color: #FEF3C7;
      color: #D97706;
    }

    .fruit-5 {
      background-color: #FEF08A;
      color: #CA8A04;
    }

    .fruit-6 {
      background-color: #DCFCE7;
      color: #16A34A;
    }

    .fruit-7 {
      background-color: #D1FAE5;
      color: #059669;
    }

    .fruit-8 {
      background-color: #E0E7FF;
      color: #4338CA;
    }

    .fruit-9 {
      background-color: #DDD6FE;
      color: #7C3AED;
    }

    .fruit-10 {
      background-color: #FCE7F3;
      color: #BE185D;
    }

    .fruit-11 {
      background-color: #FEF2F2;
      color: #B91C1C;
    }

    .game-over-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      z-index: 10;
    }

    .score-animation {
      animation: scoreUp 0.3s ease-out;
    }

    @keyframes scoreUp {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">Animal 2048</h1>
      <p class="text-gray-600">Merge same animals to create a stronger animal!</p>
    </div>
    <div class="flex justify-between items-center mb-6">
      <div class="flex gap-4">
        <div class="bg-white px-4 py-2 rounded-lg shadow-sm">
          <div class="text-xs text-gray-500 uppercase tracking-wide">
            Score
          </div>
          <div id="current-score" class="text-xl font-bold text-gray-800">
            0
          </div>
        </div>
        <div class="bg-white px-4 py-2 rounded-lg shadow-sm">
          <div class="text-xs text-gray-500 uppercase tracking-wide">
            Best Score
          </div>
          <div id="best-score" class="text-xl font-bold text-gray-800">0</div>
        </div>
      </div>
      <button id="restart-btn"
        class="flex items-center bg-primary text-white px-4 py-2 !rounded-button whitespace-nowrap hover:bg-blue-600 transition-colors">
        <div class="w-5 h-5 flex items-center justify-center mr-2 inline-block">
          <i class="ri-refresh-line"></i>
        </div>
        Restart
      </button>
    </div>
    <div class="relative">
      <div id="game-container" class="game-grid grid grid-cols-4 w-full aspect-square">
        <div class="grid-cell" data-row="0" data-col="0"></div>
        <div class="grid-cell" data-row="0" data-col="1"></div>
        <div class="grid-cell" data-row="0" data-col="2"></div>
        <div class="grid-cell" data-row="0" data-col="3"></div>
        <div class="grid-cell" data-row="1" data-col="0"></div>
        <div class="grid-cell" data-row="1" data-col="1"></div>
        <div class="grid-cell" data-row="1" data-col="2"></div>
        <div class="grid-cell" data-row="1" data-col="3"></div>
        <div class="grid-cell" data-row="2" data-col="0"></div>
        <div class="grid-cell" data-row="2" data-col="1"></div>
        <div class="grid-cell" data-row="2" data-col="2"></div>
        <div class="grid-cell" data-row="2" data-col="3"></div>
        <div class="grid-cell" data-row="3" data-col="0"></div>
        <div class="grid-cell" data-row="3" data-col="1"></div>
        <div class="grid-cell" data-row="3" data-col="2"></div>
        <div class="grid-cell" data-row="3" data-col="3"></div>
      </div>
      <div id="game-over" class="game-over-overlay hidden">
        <div class="bg-white p-8 rounded-xl shadow-lg text-center">
          <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4 text-4xl">
            üò¢
          </div>
          <h2 class="text-2xl font-bold text-gray-800 mb-2">Game Over</h2>
          <p class="text-gray-600 mb-6">No more moves!</p>
          <button id="restart-game-over"
            class="bg-primary text-white px-6 py-3 !rounded-button whitespace-nowrap hover:bg-blue-600 transition-colors">
            ÂÜçÁé©‰∏ÄÊ¨°
          </button>
        </div>
      </div>
    </div>
    <div class="mt-6 text-center text-sm text-gray-500">
      <p>Use arrow keys or swipe to move the animals</p>
    </div>
    <div class="mt-8 bg-white p-4 rounded-lg shadow-sm">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">Animal Level</h3>
      <div class="grid grid-cols-6 gap-2 text-center text-xs">
        <div class="fruit-cell fruit-1 relative h-12">üê∞</div>
        <div class="fruit-cell fruit-2 relative h-12">üê±</div>
        <div class="fruit-cell fruit-3 relative h-12">üê∂</div>
        <div class="fruit-cell fruit-4 relative h-12">ü¶ä</div>
        <div class="fruit-cell fruit-5 relative h-12">üêº</div>
        <div class="fruit-cell fruit-6 relative h-12">ü¶Å</div>
      </div>
      <div class="grid grid-cols-5 gap-2 text-center text-xs mt-2">
        <div class="fruit-cell fruit-7 relative h-12">üêØ</div>
        <div class="fruit-cell fruit-8 relative h-12">üê∏</div>
        <div class="fruit-cell fruit-9 relative h-12">ü¶â</div>
        <div class="fruit-cell fruit-10 relative h-12">ü¶Ñ</div>
        <div class="fruit-cell fruit-11 relative h-12">üê≤</div>
      </div>
    </div>
    <div class="mt-8 bg-white p-4 rounded-lg shadow-sm text-center">
      <div class="text-gray-600 mb-2">Created with ‚ù§Ô∏è by MUKI Vibe Coding</div>
      <div class="flex justify-center gap-4">
        <a href="https://muki.tw" target="_blank" class="text-blue-500 hover:text-blue-600 flex items-center gap-1">
          <i class="ri-global-line"></i>
          MUKI space*
        </a>
        <a href="https://github.com/mukiwu/web-game-vibe-coding" target="_blank"
          class="text-blue-500 hover:text-blue-600 flex items-center gap-1">
          <i class="ri-github-fill"></i>
          GitHub
        </a>
      </div>
    </div>
  </div>
  <script id="game-logic">
    class Game2048 {
      constructor() {
        this.grid = Array(4)
          .fill()
          .map(() => Array(4).fill(0));
        this.score = 0;
        this.bestScore = localStorage.getItem("bestScore") || 0;
        this.fruits = [
          "",
          "üê∞",
          "üê±",
          "üê∂",
          "ü¶ä",
          "üêº",
          "ü¶Å",
          "üêØ",
          "üê∏",
          "ü¶â",
          "ü¶Ñ",
          "üê≤",
        ];
        this.gameContainer = document.getElementById("game-container");
        this.currentScoreEl = document.getElementById("current-score");
        this.bestScoreEl = document.getElementById("best-score");
        this.gameOverEl = document.getElementById("game-over");
        this.updateDisplay();
        this.addRandomFruit();
        this.addRandomFruit();
        this.render();
      }
      addRandomFruit() {
        const emptyCells = [];
        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 4; j++) {
            if (this.grid[i][j] === 0) {
              emptyCells.push([i, j]);
            }
          }
        }
        if (emptyCells.length > 0) {
          const randomCell =
            emptyCells[Math.floor(Math.random() * emptyCells.length)];
          this.grid[randomCell[0]][randomCell[1]] = Math.random() < 0.9 ? 1 : 2;
        }
      }
      render() {
        const cells = this.gameContainer.querySelectorAll(".grid-cell");
        cells.forEach((cell) => {
          const existingFruit = cell.querySelector(".fruit-cell");
          if (existingFruit) {
            existingFruit.remove();
          }
        });
        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 4; j++) {
            if (this.grid[i][j] !== 0) {
              const cell = this.gameContainer.querySelector(
                `[data-row="${i}"][data-col="${j}"]`,
              );
              const fruitEl = document.createElement("div");
              fruitEl.className = `fruit-cell fruit-${this.grid[i][j]}`;
              fruitEl.textContent = this.fruits[this.grid[i][j]];
              cell.appendChild(fruitEl);
            }
          }
        }
      }
      move(direction) {
        let moved = false;
        let newGrid = this.grid.map((row) => [...row]);
        if (direction === "left" || direction === "right") {
          for (let i = 0; i < 4; i++) {
            let row = newGrid[i];
            if (direction === "right") row = row.reverse();
            let newRow = row.filter((val) => val !== 0);
            for (let j = 0; j < newRow.length - 1; j++) {
              if (newRow[j] === newRow[j + 1]) {
                newRow[j]++;
                this.score += Math.pow(2, newRow[j]) * 10;
                newRow[j + 1] = 0;
              }
            }
            newRow = newRow.filter((val) => val !== 0);
            while (newRow.length < 4) newRow.push(0);
            if (direction === "right") newRow = newRow.reverse();
            if (JSON.stringify(row) !== JSON.stringify(newRow)) moved = true;
            newGrid[i] = newRow;
          }
        } else {
          for (let j = 0; j < 4; j++) {
            let col = [];
            for (let i = 0; i < 4; i++) {
              col.push(newGrid[i][j]);
            }
            if (direction === "down") col = col.reverse();
            let newCol = col.filter((val) => val !== 0);
            for (let i = 0; i < newCol.length - 1; i++) {
              if (newCol[i] === newCol[i + 1]) {
                newCol[i]++;
                this.score += Math.pow(2, newCol[i]) * 10;
                newCol[i + 1] = 0;
              }
            }
            newCol = newCol.filter((val) => val !== 0);
            while (newCol.length < 4) newCol.push(0);
            if (direction === "down") newCol = newCol.reverse();
            for (let i = 0; i < 4; i++) {
              if (newGrid[i][j] !== newCol[i]) moved = true;
              newGrid[i][j] = newCol[i];
            }
          }
        }
        if (moved) {
          this.grid = newGrid;
          this.addRandomFruit();
          this.render();
          this.updateDisplay();
          if (this.isGameOver()) {
            this.showGameOver();
          }
        }
      }
      isGameOver() {
        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 4; j++) {
            if (this.grid[i][j] === 0) return false;
            if (i < 3 && this.grid[i][j] === this.grid[i + 1][j]) return false;
            if (j < 3 && this.grid[i][j] === this.grid[i][j + 1]) return false;
          }
        }
        return true;
      }
      showGameOver() {
        this.gameOverEl.classList.remove("hidden");
      }
      updateDisplay() {
        this.currentScoreEl.textContent = this.score;
        if (this.score > this.bestScore) {
          this.bestScore = this.score;
          localStorage.setItem("bestScore", this.bestScore);
          this.bestScoreEl.classList.add("score-animation");
          setTimeout(
            () => this.bestScoreEl.classList.remove("score-animation"),
            300,
          );
        }
        this.bestScoreEl.textContent = this.bestScore;
      }
      restart() {
        this.grid = Array(4)
          .fill()
          .map(() => Array(4).fill(0));
        this.score = 0;
        this.gameOverEl.classList.add("hidden");
        this.addRandomFruit();
        this.addRandomFruit();
        this.render();
        this.updateDisplay();
      }
    }
    let game = new Game2048();
  </script>
  <script id="game-controls">
    document.addEventListener("DOMContentLoaded", function () {
      document.addEventListener("keydown", function (e) {
        switch (e.key) {
          case "ArrowLeft":
            e.preventDefault();
            game.move("left");
            break;
          case "ArrowRight":
            e.preventDefault();
            game.move("right");
            break;
          case "ArrowUp":
            e.preventDefault();
            game.move("up");
            break;
          case "ArrowDown":
            e.preventDefault();
            game.move("down");
            break;
        }
      });
      document.getElementById("restart-btn").addEventListener("click", function () {
        game.restart();
      });
      document
        .getElementById("restart-game-over")
        .addEventListener("click", function () {
          game.restart();
        });
    });
  </script>
  <script id="touch-controls">
    document.addEventListener("DOMContentLoaded", function () {
      let startX, startY;
      const gameContainer = document.getElementById("game-container");
      gameContainer.addEventListener("touchstart", function (e) {
        e.preventDefault();
        const touch = e.touches[0];
        startX = touch.clientX;
        startY = touch.clientY;
      });
      gameContainer.addEventListener("touchend", function (e) {
        e.preventDefault();
        if (!startX || !startY) return;
        const touch = e.changedTouches[0];
        const endX = touch.clientX;
        const endY = touch.clientY;
        const diffX = startX - endX;
        const diffY = startY - endY;
        if (Math.abs(diffX) > Math.abs(diffY)) {
          if (diffX > 30) {
            game.move("left");
          } else if (diffX < -30) {
            game.move("right");
          }
        } else {
          if (diffY > 30) {
            game.move("up");
          } else if (diffY < -30) {
            game.move("down");
          }
        }
        startX = null;
        startY = null;
      });
      gameContainer.addEventListener("touchmove", function (e) {
        e.preventDefault();
      });
    });
  </script>
</body>

</html>
